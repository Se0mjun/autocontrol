# PI 제어기와 지연 보상기(Lag Compensator) 설계

## 1. PI 제어기 설계

### 1.1 PI 제어기의 기본 개념

PI(Proportional-Integral) 제어기는 비례 제어(Proportional Control)와 적분 제어(Integral Control)를 결합한 형태로, 다음과 같은 전달함수를 가집니다:

```
D(s) = Kp + Ki/s = Kp(s + Ki/Kp)/s
```

여기서:
- Kp: 비례 이득
- Ki: 적분 이득
- Ki/Kp: 제어기의 영점 위치

PI 제어기는 다음과 같은 특성을 가지고 있습니다:
- 정상 상태 오차 감소 (적분 요소로 인해)
- 시스템 타입 증가 (극점이 원점에 추가되어)
- 과도 응답 특성에 영향 가능성 (추가된 극점과 영점으로 인해)

### 1.2 PI 제어기 설계 예시

다음과 같은 설계 문제를 살펴보겠습니다:

**문제**: 시스템의 폐루프 전달함수가 s = -0.174인 극점을 가집니다. 이 극점의 과도 상태 응답을 변화시키지 않으면서 정상 상태 오차를 향상시키는 PI 제어기를 설계하세요.

**시스템 구성**:
```
         +     │      │      
R(s) ──→ ⊕ ──→ │ K │──→ │  G(s) = 1/(s(s+1)(s+2)(s+10))  │──→ Y(s)
         -     │      │      
         ↑               
         │               
         └───────────────
```

**PI 제어기 설계**:

1. PI 제어기의 전달함수는 다음과 같이 정의됩니다:
   ```
   D(s) = Kp(s + Ki/Kp)/s = Kp(s + 0.1)/s
   ```
   여기서 Ki/Kp = 0.1로 선택했습니다.

2. 기존 극점 위치를 확인하기 위해 특성방정식을 분석합니다:
   - 폐루프 특성방정식: (s+1)(s+2)(s+10) + K = 0
   - s^3 + 13s^2 + 32s + (20+K) = 0
   - 이를 표준 2차 시스템 형태로 변환: (s+d)(s^2 + 0.348ωn·s + ωn^2) = 0

3. 방정식을 전개하여 다음 관계식을 얻습니다:
   - 13 = 0.348ωn + d
   - 32 = ωn^2 + 0.348ωn·d
   - 20 + K = ωn^2·d

4. 위의 식을 풀어 ωn = 3.99, ζ = 0.0, d = 이므로 s = -ωn·ζ ± j·ωn·√(1-ζ^2) = -0.69 ± j·3.93

5. 원하는 극점 위치에서 이득을 계산: K = |(s+1)(s+2)(s+10)|_{s=-0.69±j3.93} = 164

6. PI 제어기를 적용한 개루프 전달함수:
   ```
   O.L.T.F = Kp(s + 0.1)/(s(s+1)(s+2)(s+10))
   ```

7. 특성방정식:
   ```
   s^4 + 13s^3 + 32s^2 + (20+Kp)s + 0.1Kp = 0
   ```

8. 이 식을 MATLAB으로 분석한 결과, PI 제어기가 극점의 위치를 크게 변화시키지 않으면서 시스템 타입을 1 증가시킴을 확인했습니다.

## 2. 지연 보상기(Lag Compensator)

### 2.1 지연 보상기의 기본 개념

지연 보상기는 PI 제어기와 유사한 기능을 제공하지만 다른 구조를 가집니다. 전달함수는 다음과 같습니다:

```
Dc(s) = K·(s + z)/(s + p)
```

여기서:
- z: 보상기의 영점
- p: 보상기의 극점
- 지연 보상기에서는 z > p (극점이 영점보다 원점에 더 가까움)

지연 보상기의 목적은 다음과 같습니다:
- 정상 상태 오차를 줄이기 (원점 근처에 극점을 배치)
- 과도 응답 특성을 유지하기 (영점과 극점이 서로 가까이 위치)
- 시스템 타입 증가 없이 정상 상태 성능 향상

### 2.2 지연 보상기 설계 원리

지연 보상기를 사용하면 원점에 극점을 추가하지 않고도 정상 상태 오차를 감소시킬 수 있습니다. 이는 error constant 개념을 이용합니다.

예를 들어, 속도 오차 상수 Kv를 고려할 때:

1. 보상기 적용 전 Kv:
   ```
   Kv = lim(s→0) s·G(s) = z1·z2·.../(p1·p2·...)
   ```

2. 보상기 적용 후 Kv,c:
   ```
   Kv,c = lim(s→0) s·K·(s+z)/(s+p)·G(s) = K·z·z1·z2·.../(p·p1·p2·...) = (z/p)·Kv
   ```

3. 정상 상태 오차를 줄이기 위해서는 Kv,c > Kv 조건이 필요하므로 z > p 관계가 만족되어야 합니다.

4. 그러나 z와 p의 차이가 클수록 각도 조건에 영향을 주어 원래 가지고 있던 시간 응답 특성이 손상될 수 있습니다.

5. 이 문제를 해결하기 위해 p를 아주 작은 값(원점 매우 근처)으로 선택하고, z/p 비율을 조절합니다.
   예: z/p = 100 (z = 0.01, p = 0.0001)

### 2.3 지연 보상기 설계 예시

**문제**: 감쇠비가 0.174인 시스템의 정상 상태 오차를 10배 향상시키도록 지연 보상기를 설계하세요.

**시스템 구성**:
```
         +     │           │      
R(s) ──→ ⊕ ──→ │ Dc(s) │──→ │  G(s) = 1/(s(s+1)(s+2)(s+10))  │──→ Y(s)
         -     │           │      
         ↑                       
         │                       
         └───────────────────────
```

**설계 과정**:

1. **보상기 형태 결정**:
   - 정상 상태 오차를 개선하기 위해 지연 보상기 선택: `Dc(s) = K·(s+z)/(s+p)`

2. **요구사항 분석**:
   - 현재 시스템 타입: 0 (개루프 전달함수에 원점에 극점 1개)
   - 현재 정상 상태 오차: Ess = 1/(1+Kp) = 1/(1+8.23) = 0.108
   - 목표 정상 상태 오차: Ess,c = 0.108/10 = 0.0108

3. **보상기 설계**:
   - Ess,c = 1/(1+Kp,c) = 0.0108 → Kp,c = 1/0.0108 - 1 = 91.59
   - Kp,c = Kp·(z/p) → 91.59 = 8.23·(z/p) → z/p = 91.59/8.23 = 11.13
   - p = 0.01로 선택 → z = 11.13 × 0.01 = 0.111

4. **최종 보상기 전달함수**:
   ```
   Dc(s) = K·(s+0.111)/(s+0.01)
   ```

5. **이득 K 계산**:
   - 원하는 감쇠비 0.174를 유지하기 위한 K 값을 계산
   - 폐루프 극점 위치: s = -0.694 ± j3.836
   - K = |(s+0.01)(s+1)(s+2)(s+10)/(s+0.111)|_{s=-0.694±j3.836} = 158.1

6. **최종 보상기**:
   ```
   Dc(s) = 158.1·(s+0.111)/(s+0.01)
   ```

7. **설계 검증**:
   - 정상 상태 오차: Ess = 1/(1+158.1·0.111/0.01·1·2·10) = 0.011
   - 목표인 0.0108과 거의 일치 → 설계 성공!

## 3. PI 제어기와 지연 보상기 비교

### 3.1 구조적 차이점

**PI 제어기**:
- 전달함수: `D(s) = Kp + Ki/s = Kp(s + Ki/Kp)/s`
- 원점에 극점 추가 (시스템 타입 증가)
- 영점 위치: s = -Ki/Kp

**지연 보상기**:
- 전달함수: `Dc(s) = K(s + z)/(s + p)` (z > p)
- 원점 근처에 극점과 영점 추가 (시스템 타입 유지)
- 극점과 영점의 비율(z/p)로 성능 조절

### 3.2 성능 특성 비교

**PI 제어기**:
- 장점: 정상 상태 오차 완전 제거 가능 (스텝 입력에 대해)
- 단점: 시스템 타입 증가로 인한 안정성 저하 가능성
- 단점: 극점이 원점에 추가되어 과도 응답 특성 변화

**지연 보상기**:
- 장점: 과도 응답 특성을 크게 변화시키지 않음
- 장점: 정상 상태 오차 감소 (완전 제거는 불가능)
- 장점: 안정성에 미치는 영향 최소화
- 단점: 매우 작은 p 값으로 인해 느린 응답 가능성

### 3.3 적용 시나리오

**PI 제어기 적합 상황**:
- 정상 상태 오차를 완전히 제거해야 하는 경우
- 과도 응답의 일부 변화가 허용되는 경우
- 시스템 타입 증가가 필요한 경우

**지연 보상기 적합 상황**:
- 기존 과도 응답 특성을 최대한 유지해야 하는 경우
- 정상 상태 오차 감소가 필요하지만 완전한 제거는 필요 없는 경우
- 시스템의 안정성 마진 유지가 중요한 경우

## 4. 추가 고려사항

### 4.1 위상 마진과 이득 마진 영향

지연 보상기는 위상 마진을 감소시킬 수 있습니다. 이는 z와 p 사이의 간격이 클수록 심화됩니다. 실제 설계에서는 다음을 고려해야 합니다:

- 위상 마진 확인: 지연 보상기 적용 후 위상 마진이 충분한지 검증
- 이득 마진 확인: 시스템의 이득 마진이 적절한지 확인
- 필요시 위상-선행(lead) 보상기와 결합하여 위상 마진 확보

### 4.2 구현 고려사항

**PI 제어기 구현**:
- 적분기 포화(integral windup) 방지 메커니즘 필요
- 디지털 구현 시 적분 근사화 방법 고려 (사다리꼴 법칙, 후방 직사각형 등)

**지연 보상기 구현**:
- 매우 작은 p 값으로 인한 수치적 문제 가능성
- 매우 큰 이득 K로 인한 센서 노이즈 증폭 우려

### 4.3 다양한 입력에 대한 응답 분석

시스템의 응답은 입력 신호 유형에 따라 달라집니다:

**스텝 입력 (위치 명령)**:
- PI 제어기: 0 정상 상태 오차
- 지연 보상기: 감소된 정상 상태 오차

**램프 입력 (속도 명령)**:
- PI 제어기: 유한한 정상 상태 오차
- 지연 보상기: 감소된 정상 상태 오차

**가속도 입력**:
- PI 제어기: 무한한 정상 상태 오차
- 지연 보상기: 감소된 무한 정상 상태 오차

## 5. 실제 적용 예시

### 5.1 모터 속도 제어 시스템

**시스템 모델**:
```
G(s) = K/(s(τs+1))
```

**기존 P 제어기**:
- 정상 상태 오차: 10%
- 과도 응답: 만족스러움

**개선 옵션 1: PI 제어기**
```
D(s) = Kp + Ki/s
```
- 결과: 정상 상태 오차 제거, 과도 응답 약간 변화

**개선 옵션 2: 지연 보상기**
```
Dc(s) = K(s+0.1)/(s+0.01)
```
- 결과: 정상 상태 오차 1% 미만, 과도 응답 거의 동일

### 5.2 온도 제어 시스템

**시스템 모델**:
```
G(s) = K/(s+a)(s+b)
```

**기존 P 제어기**:
- 정상 상태 오차: 5%
- 응답 시간: 적절

**개선 옵션 1: PI 제어기**
```
D(s) = Kp + Ki/s
```
- 결과: 정상 상태 오차 제거, 오버슈트 증가

**개선 옵션 2: 지연 보상기**
```
Dc(s) = K(s+0.05)/(s+0.005)
```
- 결과: 정상 상태 오차 0.5%, 오버슈트 미미한 증가

## 6. 결론

PI 제어기와 지연 보상기는 모두 정상 상태 오차를 개선하기 위한 효과적인 도구이지만, 시스템 요구사항에 따라 적절한 선택이 달라집니다:

1. **정상 상태 오차 완전 제거가 필수적인 경우**: PI 제어기 선택
2. **과도 응답 특성 유지가 중요한 경우**: 지연 보상기 선택
3. **두 가지 모두 중요한 경우**: PID 제어기 또는 위상-선행-지연 보상기 고려

실제 시스템 설계에서는 시뮬레이션과 실험을 통해 선택한 제어기의 성능을 검증하고, 필요에 따라 파라미터를 미세 조정하는 과정이 필요합니다.

## 7. 실습 문제

### 문제 1
다음과 같은 시스템에 대해:
```
G(s) = 10/(s(s+4))
```
정상 상태 오차를 5% 이하로 줄이면서 오버슈트를 20% 미만으로 유지하는 PI 제어기와 지연 보상기를 각각 설계하고 그 성능을 비교하세요.

### 문제 2
온도 제어 시스템의 모델이 다음과 같습니다:
```
G(s) = 2/(s+1)(s+5)
```
스텝 입력에 대한 정상 상태 오차를 현재의 1/5로 줄이되, 정착 시간은 10% 이상 증가하지 않도록 지연 보상기를 설계하세요.